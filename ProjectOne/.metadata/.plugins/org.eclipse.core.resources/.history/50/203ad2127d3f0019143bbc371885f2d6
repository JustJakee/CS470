import java.io.IOException;
import java.net.*;
import java.util.ArrayList;

public class PeerToPeer 
{
  public static ArrayList<String> ipList = new ArrayList<>(); //output

  public static void main(String[] args) throws Exception 
  {
	//Client List - IP information included 
	ipList.add("localhost"); 
	ipList.add("localhost"); 
	ipList.add("localhost"); 
	ipList.add("1"); 
	
    startReciever(); //Begin server thread
    startSender(); //Begin client thread
  }

  public static void startSender() throws UnknownHostException
  {
    (new Thread() 
    {
        @Override
        public void run() 
        {
        	
        	byte data[] = "Client x is up".getBytes();
            DatagramSocket socket = null;
            
            try 
            {
                socket = new DatagramSocket();
                socket.setBroadcast(true);
            } 
            catch (SocketException ex) 
            {
                ex.printStackTrace();
            }
            
            while (true)
            {
	        	for (int j = 0; j < ipList.size(); j++) 
	        	{
	        		InetAddress ipAddress;
					try 
					{
						ipAddress = InetAddress.getByName(ipList.get(j));
						if (ipAddress.isReachable(5000))
						{
							String upString = "Cleint " + (j + 1) + " is up";
				            byte dataUp[] = upString.getBytes();
							DatagramPacket sendPacket = new DatagramPacket(dataUp,data.length,ipAddress,9876);
			                socket.send(sendPacket);
						}
						else
						{
							for (int i = 0; i < ipList.size(); i++)
							{
								String downString = "Client " + (j + 1) + " is down";
					            byte dataFail[] = downString.getBytes();
								DatagramPacket sendPacket = new DatagramPacket(dataFail, dataFail.length, InetAddress.getByName(ipList.get(i)), 9876);
								socket.send(sendPacket);
							}
						}
		                
		                Thread.sleep(5000);
					} 
					catch (UnknownHostException e) 
					{
						System.out.println("Client " + (j + 1) + " is down.");
					}
					catch (IOException ex) 
	                {
						System.out.println("Client " + (j + 1) + " is down.");
	                }
					catch (InterruptedException e)
					{
						System.out.println("Client " + (j + 1) + " is down.");
					}
	        	}
            }
        }
        }).start();
    }

  public static void startServer() 
  {
    (new Thread() 
    {
        @Override
        public void run() 
        {
                DatagramSocket serverSocket = null;
                
                try 
                {
                	serverSocket = new DatagramSocket(9876);
                } 
                catch (SocketException ex) 
                {
                    ex.printStackTrace();
                }
                
                DatagramPacket receivePacket = new DatagramPacket(new byte[1024], 1024);
                
                while (true) 
                {
                	try 
                	{
                		serverSocket.receive(receivePacket);
	                    String temp = new String(receivePacket.getData());
	                    
	                    System.out.println(temp);
                	} 
                	catch (IOException ex) 
                	{
	                    ex.printStackTrace();
                	}
                }
            }
    }).start();
 }
}